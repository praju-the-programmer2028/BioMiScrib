<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--Since UTF-8 supports Unicode(‚ù§Ô∏è üß¨ üß†), I can use this to encode characters such as bio emoji icons.-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Scales website display on devices, normalizing web layout.-->

    <title>BioMiScrib: Biological Self-Portrait</title>
    <!--Title of the project-->
    
    <!-- p5.js library for drawing bio icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <!--Loads external p5.js library, allowing canvas construction through a Content Delivery Network (CDN)-->

    <style>
        * {
            /* To maintain consistent margin padding in this website, CSS allows to force borders at standard dimensions. This also prevents expansion bugs when viewing.  */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
        /* Defines full-screen canvas dimensions in viewport units (vw/vh) to prevent scrolling */
            overflow: hidden;
        /* Hides overflowing content for tools to stay within defined web layout */
            font-family: 'Space Mono', monospace;
        /* Space Mono provides that futuristic biotech lab feel */
            background: linear-gradient(135deg, #0a0e27 0%, #16213e 50%, #1a1a2e 100%);
            color: #fff;
        /* To create more depth in intro page, I selected a gradient background that flows linearly. */
        }
    
    
        
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0e27 0%, #16213e 50%, #1a1a2e 100%);
            /*The typewriter effect is fixed and built for stacking (prevents interaction until intro screen is fully done displaying)*/

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            gap: 40px;
            /* Flexbox is a modern layout model used to vertically and horizontally center-align intro text */
        }
        
        .intro-text {
            font-size: 32px;
            color: #00ff88;
            text-align: center;
            letter-spacing: 2px;
            /* Center aligning letters (spaced evenly), preventing layout shift during typing */

            min-height: 100px;
            font-weight: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center other content too */
        }
        
        .intro-text.line2 {
            color: #00d9ff;
            /* A cooler tone to bright green, but not too contrasting to take away from gradient background. */
            font-size: 28px;
            /* Medium sized font enough to fit the center half of website, but still spacious. */
            letter-spacing: 4px;
            /* second intro line: this stands for the tag line text which is center from left to right but not top to bottom. */
        }
        
        .blinking-cursor {
        /* blinking cursor simulates the typewriter effect with the blinking and "|" shown when displaying (as if someone is typing in real time). */
            display: inline-block;
            /* if each text were in a "block", each character is inline with text with custom width and height following line flow. */
            width: 3px;
            /* The idea visual thickness of this cursor would be 3px as it can be unreadable if too thin or a thick bar if it is too big. */
            height: 40px;
            /* Cursor height is slightly taller that the text's capped height to emphasize the blinking cursor more "|". */
            background: #00ff88;
            /* Cursor color matches intro neon green text tone to maintain gradient and text color scheme consistency. */
            margin-left: 8px;
            /* To prevent cursor from directly touching last letter, this margin offset mimics cursor"|" gap in real time. */
            animation: blink 1s infinite;
            /* The cursor continues to blink even after displaying the text in a full cycle rotation as part of CSS animation compositor layer based on embedded keyframes/sec *//
        }
        
        .intro-text.line2 .blinking-cursor {
            background: #00d9ff;
            height: 35px;
        }
        
        @keyframes blink {
            0% /* start of cycle */, 49% /* almost halfway through cycle */, 100% /* end of cycle*/ { opacity: 1; /* amplifies that crisp blink during typewriter display */}
            50%, 99% /* cursor would be fully hidden for stable transition exactly halfway and just before the end of the cycle */ { opacity: 0; }
            /* Using 0 and 1s for opacity allows for that binary state switch between hard blink and softer continuous blink */
        }
        
        .explore-btn {
            /* The "Explore" Button serves a transition between the intro and BioMiScrib webcam drawing tool. */
            padding: 15px 40px;
            /* Internal Spacing of the button more towards bottom and mostly equal left/right spacing */
            background: rgba(0, 255, 136, 0.2 /* 20% opacity background for the button */); 
            /* Stronger contrast green to highlight button */
            border: 2px solid #00ff88;
            /* The stroke is light around the button board */
            color: #00ff88;
            font-size: 18px;
            /* Larger than body text to emphasize as next step to take to actually enter the gaming tool */
            cursor: pointer;
            /* Changes interactive mouse interaction to pointer to click on */
            border-radius: 8px;
            /* Chamfers/softerns the edges to make the button more approachable and organic instead of the normal sharp rectangle edges */
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            /* Capitalizing text also emphasizes the need to press this button to move on. */
            letter-spacing: 2px;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 5s;
            /* The smooth animation prevents a sudden visual change to canvas. Instead, the transition is responsive and eases into main canvas "ease". The background is all and text is faded in. */
            /* The intro slows the user down, reinforcing a philosophical layer. Before taking action to find your identity, you must reflect on yourself. */
        }
        
        .explore-btn:hover {
            background: rgba(0, 255, 136, 0.4);
            /* During transition, the background increases opacity to 40% . */
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
            /* Neon box shadow after clicking signaling biological pulse/energy put into explore yourself */
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        #p5-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #video-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 320px;
            height: 240px;
            border: 3px solid #00ff88;
            border-radius: 12px;
            z-index: 30;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            background: #000;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            display: block;
        }
        
        .icon-selector {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #00ff88;
            z-index: 20;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.2);
            max-width: 350px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .icon-selector h2 {
            font-size: 16px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #00ff88;
            font-weight: 700;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .icon-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #00ffff;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .icon-btn:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .icon-btn.selected {
            background: #00ffff;
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            color: #00ffff;
        }
        
        .color-input-group {
            display: grid;
            grid-template-columns: 1fr 45px;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .color-input-group input[type="range"] {
            width: 100%;
            height: 24px;
            cursor: pointer;
            accent-color: #00ff88;
        }
        
        .color-value {
            background: rgba(0, 255, 136, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            color: #00ff88;
            text-align: center;
        }
        
        .color-preview {
            width: 80px;
            height: 50px;
            border-radius: 4px;
            border: 2px solid #00ff88;
            margin-top: 8px;
        }
        
        .slider-group {
            margin-bottom: 12px;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(0, 255, 136, 0.2);
            outline: none;
            accent-color: #00ff88;
            cursor: pointer;
        }
        
        .slider-value {
            font-size: 12px;
            color: #00ffff;
            margin-top: 4px;
            text-align: center;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 64, 129, 0.2);
            border: 2px solid #ff4081;
            color: #ff4081;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            font-family: 'Space Mono', monospace;
            transition: all 0.3s ease;
        }
        
        .action-btn.selected {
            background: #00ff88;
            border-color: #00ffff;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }
        
        .action-btn.recording {
            background: #ff4081;
            color: #fff;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 64, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 64, 129, 1); }
        }
        
        .clear-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 170, 0, 0.2);
            border: 2px solid #ffaa00;
            color: #ffaa00;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            font-family: 'Space Mono', monospace;
            transition: all 0.3s ease;
        }
        
        .clear-btn:hover {
            background: rgba(255, 170, 0, 0.4);
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
        }
        
        .toggle-btn {
            position: absolute;
            top: 20px;
            right: 360px;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 21;
            font-family: 'Space Mono', monospace;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .instructions-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #00ffff;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            font-size: 13px;
            line-height: 1.6;
            z-index: 21;
            box-shadow: 0 8px 32px rgba(0, 255, 255, 0.2);
            display: none;
        }
        
        .instructions-panel h2 {
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .instructions-panel h3 {
            color: #00ff88;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .instructions-panel p {
            color: #d0d0d0;
            margin-bottom: 8px;
        }
        
        .instructions-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .instructions-panel::-webkit-scrollbar-track {
            background: rgba(0, 255, 255, 0.1);
        }
        
        .instructions-panel::-webkit-scrollbar-thumb {
            background: #00ffff;
            border-radius: 10px;
        }
        
        .status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.95);
            padding: 12px 16px;
            border-radius: 6px;
            border: 2px solid #ffaa00;
            color: #ffaa00;
            font-size: 12px;
            z-index: 20;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status.ready {
            border-color: #00ff88;
            color: #00ff88;
        }
        
        .status.recording {
            border-color: #ff4081;
            color: #ff4081;
            animation: pulse 1s infinite;
        }
        
        .instruction-text {
            position: absolute;
            top: 80px;
            right: 360px;
            background: rgba(10, 14, 39, 0.9);
            padding: 15px 20px;
            border-radius: 8px;
            border: 2px solid #00ff88;
            color: #00ff88;
            font-size: 13px;
            max-width: 250px;
            z-index: 21;
            text-align: center;
            line-height: 1.5;
        }
        
        .icon-selector::-webkit-scrollbar {
            width: 6px;
        }
        
        .icon-selector::-webkit-scrollbar-track {
            background: rgba(0, 255, 136, 0.1);
        }
        
        .icon-selector::-webkit-scrollbar-thumb {
            background: #00ff88;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- TYPEWRITER INTRO SCREEN -->
    <div id="intro-screen">
        <div class="intro-text">
        <!-- The -->
            <span id="line1"></span><span class="blinking-cursor"></span>
        </div>
        <div class="intro-text line2">
            <span id="line2"></span><span class="blinking-cursor"></span>
        </div>
        <button class="explore-btn" id="exploreBtn">Explore Now!</button>
    </div>
    
    <div id="p5-container"></div>
    
    <!-- Webcam video preview -->
    <div id="video-container">
        <video id="video" autoplay playsinline></video>
    </div>
    
    <button class="toggle-btn" id="toggleInstructions">Show Guide</button>
    <div class="instruction-text">
        üìå Select icon<br>
        üñ±Ô∏è Click to place<br>
        üñêÔ∏è Drag to move<br>
        üì∏ Record when done!
    </div>
    
    <div class="instructions-panel" id="instructionsPanel">
        <h2>üß¨ BioMiScrib</h2>
        <p><strong>Instructions & Purpose</strong></p>
        
        <p>A celebration of your biological essence. Recognize your biological identity through visual composition. You are made of the same heart, DNA, lungs as everyone else‚Äîthat shared biology is worth celebrating.</p>
        
        <h3>HOW TO USE:</h3>
        <p>1Ô∏è‚É£ Select a bio icon from the grid</p>
        <p>2Ô∏è‚É£ Click anywhere on the canvas to place it</p>
        <p>3Ô∏è‚É£ Drag icons around to compose</p>
        <p>4Ô∏è‚É£ Adjust size and capture</p>
        
        <h3>BIO ICONS:</h3>
        <p>‚ù§Ô∏è Heart | üß† Brain | ü´Å Lungs</p>
        <p>üß¨ DNA | üëÅÔ∏è Eye | ü¶† Virus</p>
        <p>ü©∏ Blood | üíÄ Bone | üß™ Chemistry | ‚öóÔ∏è Potion</p>
        
        <h3>CONTROLS:</h3>
        <p>üì∑ Photo - Save your artwork</p>
        <p>üé• Video - Record creation</p>
        <p>üóëÔ∏è Clear - Start fresh</p>
        <p>üñêÔ∏è Drag - Move placed icons</p>
    </div>
    
    <div class="icon-selector">
        <h2>üß¨ BioMiScrib</h2>
        
        <div class="control-group">
            <label>Select Icon</label>
            <div class="icon-grid" id="iconGrid"></div>
        </div>
        <div class="control-group">
            <label>üé® Color</label>
            <div style="margin-top: 8px;">
                <div class="color-preview" id="colorPreview"></div>
            </div>
            <p style="font-size: 11px; color: #00ffff; margin-top: 8px; text-align: center;">
                Neon Pink ‚ú®
            </p>
        </div>
        
        <div class="slider-group">
            <label>Icon Size</label>
            <input type="range" id="sizeSlider" min="30" max="200" value="80">
            <div class="slider-value" id="sizeValue">80px</div>
        </div>
        
        <div class="button-group">
            <button class="action-btn" id="drawModeBtn">üñåÔ∏è Draw</button>
            <button class="action-btn" id="placeModeBtn">üìå Place</button>
        </div>
        
        <div class="button-group">
            <button class="action-btn" id="photoBtn">üì∑ Photo</button>
            <button class="action-btn" id="videoBtn">üé• Video</button>
            <button class="clear-btn" id="clearBtn">üóëÔ∏è Clear</button>
        </div>
    </div>
    
    <div class="status" id="status">Ready to create!</div>

    <script>

        // TYPEWRITER INTRO EFFECT 
        
        function typewriterEffect() {
            const line1Text = "BioMiScrib";
            const line2Text = "explore beyond the surface";
            
            const line1El = document.getElementById('line1');
            const line2El = document.getElementById('line2');
            
            let index1 = 0;
            let index2 = 0;
            
            function typeLine1() {
                if (index1 < line1Text.length) {
                    line1El.textContent += line1Text.charAt(index1);
                    index1++;
                    setTimeout(typeLine1, 50);
                } else {
                    setTimeout(typeLine2, 800);
                }
            }
            
            function typeLine2() {
                if (index2 < line2Text.length) {
                    line2El.textContent += line2Text.charAt(index2);
                    index2++;
                    setTimeout(typeLine2, 50);
                }
            }
            
            typeLine1();
        }
        
        // Start intro immediately on page load
        window.addEventListener('load', () => {
            typewriterEffect();
        });
        
        // Show explore button after animations
        document.getElementById('exploreBtn').addEventListener('click', () => {
            document.getElementById('intro-screen').style.display = 'none';
            startApp();
        });
        
 
        // MAIN APPLICATION //

        function startApp() {
            // GLOBAL VARIABLES
            let colorR = 255, colorG = 100, colorB = 200;
            let iconSize = 80;
            let selectedIcon = 'heart';
            let p5Instance = null;
            let video = null;
            let drawingMode = false;
            
            let isRecordingVideo = false;
            let mediaRecorder = null;
            let recordedChunks = [];
            
            // BIO ICON DATABASE //
            const bioIconDatabase = {
                heart: ['‚ù§Ô∏è', 'üíì', 'üíï', 'üíñ'],
                brain: ['üß†'],
                lungs: ['ü´Å'],
                dna: ['üß¨'],
                eye: ['üëÅÔ∏è', 'üëÄ'],
                virus: ['ü¶†'],
                blood: ['ü©∏'],
                bone: ['üíÄ'],
                chemistry: ['üß™'],
                potion: ['‚öóÔ∏è']
            };
            
            // Store drawn icons with position data
            let drawnIcons = [];
            let draggedIcon = null;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            console.log('RefloShape Drawing Mode Starting...');
            
            function updateStatus(message, isReady, isRec = false) {
                const status = document.getElementById('status');
                status.textContent = message;
                status.classList.remove('ready', 'recording');
                if (isReady) status.classList.add('ready');
                if (isRec) status.classList.add('recording');
            }
            
            function getRandomIcon(category) {
                const icons = bioIconDatabase[category];
                return icons[Math.floor(Math.random() * icons.length)];
            }
            
            // Initialize icon grid
            function initIconGrid() {
                const grid = document.getElementById('iconGrid');
                Object.keys(bioIconDatabase).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'icon-btn';
                    if (category === 'heart') btn.classList.add('selected');
                    btn.textContent = getRandomIcon(category);
                    btn.onclick = () => selectIcon(category, btn);
                    grid.appendChild(btn);
                });
            }
            
            function selectIcon(category, button) {
                document.querySelectorAll('.icon-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                button.classList.add('selected');
                selectedIcon = category;
                updateStatus('Selected: ' + category.toUpperCase(), true);
            }
            
            function takePhoto() {
                if (p5Instance && p5Instance.canvas) {
                    p5Instance.saveCanvas('RefloShape-artwork', 'png');
                    console.log('‚úì Photo saved!');
                    updateStatus('Photo Saved ‚úì', true);
                }
            }
            
            function startVideoRecording() {
                recordedChunks = [];
                const canvas = p5Instance.canvas;
                const stream = canvas.captureStream(30);
                
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp8,opus'
                });
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'RefloShape-video-' + Date.now() + '.webm';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    console.log('‚úì Video saved!');
                    updateStatus('Video Saved ‚úì', true);
                };
                
                mediaRecorder.start();
                isRecordingVideo = true;
                document.getElementById('videoBtn').classList.add('recording');
                updateStatus('Recording Video...', false, true);
            }
            
            function stopVideoRecording() {
                mediaRecorder.stop();
                isRecordingVideo = false;
                document.getElementById('videoBtn').classList.remove('recording');
            }
            
            // DRAW ORGANIC SHAPES FOR EACH BIO ICON
            function drawOrganicBioShape(p, icon, x, y, size, r, g, b, a) {
                p.fill(r, g, b, a);
                p.stroke(r, g, b, a);
                
                switch(icon) {
                    case '‚ù§Ô∏è':
                    case 'üíì':
                    case 'üíï':
                    case 'üíñ':
                        drawHeartShape(p, x, y, size);
                        break;
                    case 'üß†':
                        drawBrainShape(p, x, y, size);
                        break;
                    case 'ü´Å':
                        drawLungsShape(p, x, y, size);
                        break;
                    case 'üß¨':
                        drawDNAShape(p, x, y, size);
                        break;
                    case 'üëÅÔ∏è':
                    case 'üëÄ':
                        drawEyeShape(p, x, y, size);
                        break;
                    case 'ü¶†':
                        drawVirusShape(p, x, y, size);
                        break;
                    case 'ü©∏':
                        drawBloodShape(p, x, y, size);
                        break;
                    case 'üíÄ':
                        drawBoneShape(p, x, y, size);
                        break;
                    case 'üß™':
                        drawChemistryShape(p, x, y, size);
                        break;
                    case '‚öóÔ∏è':
                        drawPotionShape(p, x, y, size);
                        break;
                    default:
                        p.ellipse(x, y, size);
                }
            }
            
            function drawHeartShape(p, x, y, size) {
                p.push();
                p.translate(x, y);
                p.beginShape();
                for (let i = 0; i < 2 * Math.PI; i += 0.05) {
                    const nx = 16 * Math.sin(i) ** 3;
                    const ny = -(13 * Math.cos(i) - 5 * Math.cos(2*i) - 2 * Math.cos(3*i) - Math.cos(4*i));
                    p.vertex(nx * size / 30, ny * size / 30);
                }
                p.endShape(p.CLOSE);
                p.pop();
            }
            
            function drawBrainShape(p, x, y, size) {
                // SIMPLE POP ART BRAIN - Two overlapping ovals from side
                
                // LEFT OVAL - Pink
                p.fill(255, 100, 150, 255);
                p.stroke(0, 0, 0, 200);
                p.strokeWeight(Math.max(2, size / 25));
                p.ellipse(x - size/4, y, size/2, size * 0.8);
                
                // RIGHT OVAL - Cyan
                p.fill(100, 200, 255, 255);
                p.ellipse(x + size/4, y, size/2, size * 0.8);
                
                // CENTER LINE - Bold dividing line
                p.stroke(0, 0, 0, 220);
                p.strokeWeight(Math.max(2.5, size / 20));
                p.line(x, y - size/2.2, x, y + size/2.2);
            }
            
            function drawLungsShape(p, x, y, size) {
                p.noStroke();
                p.arc(x - size/3, y, size/2, size, Math.PI, 0);
                p.arc(x + size/3, y, size/2, size, Math.PI, 0);
                p.strokeWeight(2);
                p.stroke(255);
                p.line(x, y - size/3, x, y);
            }
            
            function drawDNAShape(p, x, y, size) {
                p.noFill();
                p.strokeWeight(3);
                p.beginShape();
                for (let i = 0; i < size; i++) {
                    const px = x + Math.sin(i / 10) * size / 4;
                    const py = y - size/2 + i;
                    p.vertex(px, py);
                }
                p.endShape();
                p.beginShape();
                for (let i = 0; i < size; i++) {
                    const px = x - Math.sin(i / 10) * size / 4;
                    const py = y - size/2 + i;
                    p.vertex(px, py);
                }
                p.endShape();
            }
            
            function drawEyeShape(p, x, y, size) {
                p.noFill();
                p.strokeWeight(2);
                p.ellipse(x, y, size, size * 0.6);
                p.fill(255);
                p.circle(x + size/6, y, size/3);
                p.fill(0);
                p.circle(x + size/6, y, size/6);
            }
            
            function drawVirusShape(p, x, y, size) {
                p.ellipse(x, y, size/2);
                const spikes = 8;
                for (let i = 0; i < spikes; i++) {
                    const angle = (i / spikes) * 2 * Math.PI;
                    const ex = x + Math.cos(angle) * size/2;
                    const ey = y + Math.sin(angle) * size/2;
                    p.line(x, y, ex, ey);
                    p.ellipse(ex, ey, size/6);
                }
            }
            
            function drawBloodShape(p, x, y, size) {
                p.beginShape();
                for (let i = 0; i < 2 * Math.PI; i += 0.1) {
                    const r = size / 2 * (1 + 0.5 * Math.sin(i * 3));
                    const px = x + Math.cos(i) * r;
                    const py = y + Math.sin(i) * r * 1.3;
                    p.vertex(px, py);
                }
                p.endShape(p.CLOSE);
            }
            
            function drawBoneShape(p, x, y, size) {
                p.rect(x - size/6, y - size/3, size/3, size * 2/3);
                p.ellipse(x - size/3, y - size/3, size/2);
                p.ellipse(x + size/3, y + size/3, size/2);
            }
            
            function drawChemistryShape(p, x, y, size) {
                p.noFill();
                p.strokeWeight(2);
                p.rect(x - size/3, y - size/3, size * 2/3, size);
                p.fill(255);
                p.rect(x - size/3 + 2, y + size/3 - size/3, size * 2/3 - 4, size/3 - 2);
            }
            
            function drawPotionShape(p, x, y, size) {
                p.noFill();
                p.strokeWeight(2);
                p.arc(x - size/4, y - size/4, size/2, size/2, 0, Math.PI);
                p.rect(x - size/6, y - size/4, size/3, size/2);
                p.stroke(255);
                for (let i = 0; i < 3; i++) {
                    p.arc(x, y, size/3 - i*5, size/3 - i*5, 0, Math.PI);
                }
            }
            
            // P5.JS SKETCH
            function sketch(p) {
                p.setup = function() {
                    const container = document.getElementById('p5-container');
                    let canvas = p.createCanvas(container.offsetWidth, container.offsetHeight);
                    canvas.parent('p5-container');
                    
                    video = document.getElementById('video');
                    navigator.mediaDevices.getUserMedia({ 
                        video: { width: 640, height: 480, facingMode: 'user' }
                    }).then(stream => {
                        video.srcObject = stream;
                        console.log('‚úì Webcam connected');
                        updateStatus('Ready to create!', true);
                    }).catch(err => {
                        console.error('Webcam error:', err);
                        updateStatus('Webcam Error ‚úó', false);
                    });
                    
                    p5Instance = p;
                    p.background(10, 14, 39);
                };
                
                p.draw = function() {
                    p.background(10, 14, 39);
                    
                    drawnIcons.forEach((iconData, index) => {
                        if (draggedIcon === index) {
                            p.stroke(0, 255, 255);
                            p.strokeWeight(3);
                            p.noFill();
                            p.rect(iconData.x - iconData.size/2 - 5, iconData.y - iconData.size/2 - 5, 
                                   iconData.size + 10, iconData.size + 10);
                        }
                        
                        drawOrganicBioShape(p, iconData.icon, iconData.x, iconData.y, 
                                           iconData.size, iconData.r, iconData.g, iconData.b, 255);
                    });
                    
                    if (isRecordingVideo) {
                        p.fill(255, 0, 0);
                        p.textSize(24);
                        p.textAlign(p.LEFT);
                        p.text('üî¥ REC', 30, 40);
                    }
                };
                
                p.mousePressed = function() {
                    if (drawingMode) {
                        // Drawing mode - freehand brush with bio icons
                        if (p.mouseX > 0 && p.mouseX < p.width && 
                            p.mouseY > 0 && p.mouseY < p.height) {
                            
                            const icon = getRandomIcon(selectedIcon);
                            drawnIcons.push({
                                icon: icon,
                                x: p.mouseX,
                                y: p.mouseY,
                                size: iconSize,
                                r: colorR,
                                g: colorG,
                                b: colorB
                            });
                            updateStatus('Painted: ' + icon, true);
                        }
                        return false;
                    } else {
                        // Placing mode - click to place or drag to move
                        for (let i = drawnIcons.length - 1; i >= 0; i--) {
                            const iconData = drawnIcons[i];
                            const distance = p.dist(p.mouseX, p.mouseY, iconData.x, iconData.y);
                            
                            if (distance < iconData.size / 2) {
                                draggedIcon = i;
                                dragOffsetX = p.mouseX - iconData.x;
                                dragOffsetY = p.mouseY - iconData.y;
                                return false;
                            }
                        }
                        
                        if (p.mouseX > 0 && p.mouseX < p.width && 
                            p.mouseY > 0 && p.mouseY < p.height) {
                            
                            const icon = getRandomIcon(selectedIcon);
                            drawnIcons.push({
                                icon: icon,
                                x: p.mouseX,
                                y: p.mouseY,
                                size: iconSize,
                                r: colorR,
                                g: colorG,
                                b: colorB
                            });
                            
                            console.log('Drew:', icon, 'at', p.mouseX, p.mouseY);
                            updateStatus('Placed: ' + icon, true);
                        }
                        return false;
                    }
                };
                
                p.mouseDragged = function() {
                    if (drawingMode) {
                        // In drawing mode, paint as you drag
                        if (p.mouseX > 0 && p.mouseX < p.width && 
                            p.mouseY > 0 && p.mouseY < p.height) {
                            
                            const icon = getRandomIcon(selectedIcon);
                            drawnIcons.push({
                                icon: icon,
                                x: p.mouseX,
                                y: p.mouseY,
                                size: iconSize,
                                r: colorR,
                                g: colorG,
                                b: colorB
                            });
                        }
                        return false;
                    } else {
                        // In placing mode, drag to move icons
                        if (draggedIcon !== null) {
                            drawnIcons[draggedIcon].x = p.mouseX - dragOffsetX;
                            drawnIcons[draggedIcon].y = p.mouseY - dragOffsetY;
                            return false;
                        }
                    }
                };
                
                p.mouseReleased = function() {
                    draggedIcon = null;
                };
                
                p.windowResized = function() {
                    const container = document.getElementById('p5-container');
                    if (container) {
                        p.resizeCanvas(container.offsetWidth, container.offsetHeight);
                    }
                };
            }
            
            // BUTTON CONTROLS
            document.getElementById('photoBtn').addEventListener('click', takePhoto);
            
            document.getElementById('videoBtn').addEventListener('click', () => {
                if (!isRecordingVideo) {
                    startVideoRecording();
                } else {
                    stopVideoRecording();
                }
            });
            
            document.getElementById('clearBtn').addEventListener('click', () => {
                drawnIcons = [];
                draggedIcon = null;
                updateStatus('Canvas cleared!', true);
            });
            
            document.getElementById('drawModeBtn').addEventListener('click', () => {
                drawingMode = true;
                document.getElementById('drawModeBtn').classList.add('selected');
                document.getElementById('placeModeBtn').classList.remove('selected');
                updateStatus('Drawing Mode On', true);
            });
            
            document.getElementById('placeModeBtn').addEventListener('click', () => {
                drawingMode = false;
                document.getElementById('placeModeBtn').classList.add('selected');
                document.getElementById('drawModeBtn').classList.remove('selected');
                updateStatus('Placing Mode On', true);
            });
            
            document.getElementById('sizeSlider').addEventListener('input', (e) => {
                iconSize = parseInt(e.target.value);
                document.getElementById('sizeValue').textContent = iconSize + 'px';
            });
            
            function updateColorPreview() {
                const preview = document.getElementById('colorPreview');
                preview.style.backgroundColor = `rgb(${colorR}, ${colorG}, ${colorB})`;
            }
            
            updateColorPreview();
            
            document.getElementById('toggleInstructions').addEventListener('click', () => {
                const panel = document.getElementById('instructionsPanel');
                const btn = document.getElementById('toggleInstructions');
                if (panel.style.display === 'none') {
                    panel.style.display = 'block';
                    btn.textContent = 'Hide Guide';
                } else {
                    panel.style.display = 'none';
                    btn.textContent = 'Show Guide';
                }
            });
            
            function updateColorPreview() {
                const preview = document.getElementById('colorPreview');
                preview.style.backgroundColor = `rgb(${colorR}, ${colorG}, ${colorB})`;
            }
            
            updateColorPreview();
            initIconGrid();
            
            new p5(sketch);
        }
    </script>
</body>
</html>
